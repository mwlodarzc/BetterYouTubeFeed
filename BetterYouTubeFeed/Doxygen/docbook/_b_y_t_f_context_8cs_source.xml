<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="__b_y_t_f_context_8cs_source" xml:lang="en-US">
<title>BYTFContext.cs</title>
<indexterm><primary>Data/BYTFContext.cs</primary></indexterm>
Go to the documentation of this file.<programlisting linenumbering="unnumbered"><anchor xml:id="__b_y_t_f_context_8cs_source_1l00001"/>00001 <emphasis role="keyword">using&#32;</emphasis><link linkend="_namespace_better_you_tube_feed_1_1_models">BetterYouTubeFeed.Models</link>;
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00002"/>00002 <emphasis role="keyword">using&#32;</emphasis>Microsoft.EntityFrameworkCore;
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00003"/>00003 <emphasis role="keyword">using&#32;</emphasis>Microsoft.IdentityModel.Tokens;
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00004"/>00004 <emphasis role="keyword">using&#32;</emphasis>System;
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00005"/>00005 <emphasis role="keyword">using&#32;</emphasis>System.IO;
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00006"/>00006 <emphasis role="keyword">using&#32;</emphasis>System.Linq;
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00007"/>00007 <emphasis role="keyword">using&#32;</emphasis>System.Runtime.CompilerServices;
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00008"/>00008 
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00009"/><link linkend="_namespace_better_you_tube_feed_1_1_data">00009</link> <emphasis role="keyword">namespace&#32;</emphasis><link linkend="_namespace_better_you_tube_feed_1_1_data">BetterYouTubeFeed.Data</link>;
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00013"/><link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context">00013</link> <emphasis role="keyword">public</emphasis>&#32;<emphasis role="keyword">class&#32;</emphasis><link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context">BYTFContext</link>&#32;:&#32;DbContext
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00014"/>00014 {
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00015"/><link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1adeeb9334bff87bbe93b7a9a946d5874f">00015</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;DbSet&lt;Account&gt;&#32;<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1adeeb9334bff87bbe93b7a9a946d5874f">Accounts</link>&#32;{&#32;<emphasis role="keyword">get</emphasis>;&#32;<emphasis role="keyword">set</emphasis>;&#32;}&#32;=&#32;<emphasis role="keyword">null</emphasis>!;
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00016"/>00016 
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00017"/><link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1a80ddc96bef6a30663e08224d6c36d726">00017</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;DbSet&lt;Video&gt;&#32;<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1a80ddc96bef6a30663e08224d6c36d726">Videos</link>&#32;{&#32;<emphasis role="keyword">get</emphasis>;&#32;<emphasis role="keyword">set</emphasis>;&#32;}&#32;=&#32;<emphasis role="keyword">null</emphasis>!;
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00018"/><link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1a0ca95b52157ac2bae83ee88dd1e2257c">00018</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;DbSet&lt;Channel&gt;&#32;<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1a0ca95b52157ac2bae83ee88dd1e2257c">Channels</link>&#32;{&#32;<emphasis role="keyword">get</emphasis>;&#32;<emphasis role="keyword">set</emphasis>;&#32;}&#32;=&#32;<emphasis role="keyword">null</emphasis>!;
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00019"/>00019 
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00024"/><link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1ab3e3cd98449dc6c4cdb1bfa61e25c8d2">00024</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">protected</emphasis>&#32;<emphasis role="keyword">override</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1ab3e3cd98449dc6c4cdb1bfa61e25c8d2">OnConfiguring</link>(DbContextOptionsBuilder&#32;optionsBuilder)
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00025"/>00025 &#32;&#32;&#32;&#32;{
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00026"/>00026 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;unsafe</emphasis>
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00027"/>00027 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordtype">string</emphasis>&#32;path&#32;=&#32;System.IO.Directory.GetParent(System.IO.Directory.GetParent(System.IO.Directory.GetParent(Environment.CurrentDirectory).ToString()).ToString()).ToString();
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00028"/>00028 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;optionsBuilder.UseSqlServer(<emphasis role="stringliteral">&quot;Data&#32;Source=(LocalDB)\\MSSQLLocalDB;AttachDbFilename=C:\\Users\\Micha≈Ç\\Desktop\\tmp\\BetterYouTubeFeed\\BetterYouTubeFeed\\YouTubeDatabase.mdf;Integrated&#32;Security=True;&#32;MultipleActiveResultSets&#32;=&#32;true&quot;</emphasis>);
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00029"/>00029 &#32;&#32;&#32;&#32;}
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00035"/><link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1a34d39f4397892e9fad267b794a5919cb">00035</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<emphasis role="keywordtype">bool</emphasis>&#32;<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1a34d39f4397892e9fad267b794a5919cb">DropAccount</link>(<emphasis role="keywordtype">string</emphasis>&#32;accountId)
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00036"/>00036 &#32;&#32;&#32;&#32;{
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00037"/>00037 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;var&#32;account&#32;=&#32;this.<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1adeeb9334bff87bbe93b7a9a946d5874f">Accounts</link>.Where(c&#32;=&gt;&#32;c.AccountId.Equals(accountId));
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00038"/>00038 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(account.IsNullOrEmpty())
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00039"/>00039 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<emphasis role="keyword">false</emphasis>;
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00040"/>00040 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;this.<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1adeeb9334bff87bbe93b7a9a946d5874f">Accounts</link>.Remove(account.First());
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00041"/>00041 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<emphasis role="keyword">true</emphasis>;
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00042"/>00042 &#32;&#32;&#32;&#32;}
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00047"/><link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1a5f1c8d721940c0e1efd6fc0aaccd4b23">00047</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1a5f1c8d721940c0e1efd6fc0aaccd4b23">Drop</link>()
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00048"/>00048 &#32;&#32;&#32;&#32;{
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00049"/>00049 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;var&#32;accounts&#32;=&#32;from&#32;o&#32;in&#32;this.Accounts&#32;select&#32;o;
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00050"/>00050 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">foreach</emphasis>&#32;(var&#32;account&#32;<emphasis role="keywordflow">in</emphasis>&#32;accounts)
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00051"/>00051 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;this.<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1adeeb9334bff87bbe93b7a9a946d5874f">Accounts</link>.Remove(account);
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00052"/>00052 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;var&#32;channels&#32;=&#32;from&#32;o&#32;in&#32;this.Channels&#32;select&#32;o;
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00053"/>00053 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">foreach</emphasis>&#32;(var&#32;channel&#32;<emphasis role="keywordflow">in</emphasis>&#32;channels)
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00054"/>00054 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;this.<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1a0ca95b52157ac2bae83ee88dd1e2257c">Channels</link>.Remove(channel);
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00055"/>00055 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;var&#32;videos&#32;=&#32;from&#32;o&#32;in&#32;this.Videos&#32;select&#32;o;
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00056"/>00056 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">foreach</emphasis>&#32;(var&#32;video&#32;<emphasis role="keywordflow">in</emphasis>&#32;videos)
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00057"/>00057 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;this.<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1a80ddc96bef6a30663e08224d6c36d726">Videos</link>.Remove(video);
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00058"/>00058 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;this.SaveChanges();
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00059"/>00059 &#32;&#32;&#32;&#32;}
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00063"/><link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1a669ae31540d7ab8d0c6afece6cbc0158">00063</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1a669ae31540d7ab8d0c6afece6cbc0158">AddAccount</link>()
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00064"/>00064 &#32;&#32;&#32;&#32;{
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00065"/>00065 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1adeeb9334bff87bbe93b7a9a946d5874f">Accounts</link>.Add(<link linkend="_class_better_you_tube_feed_1_1_you_tube_data_a_p_i">YouTubeDataAPI</link>.<link linkend="_class_better_you_tube_feed_1_1_you_tube_data_a_p_i_1ae45ec28c4813f78089382c26cf6572b8">GetAccountInfo</link>());
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00066"/>00066 &#32;&#32;&#32;&#32;}
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00067"/>00067 
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00071"/><link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1af879eaad910aedf7600094c3f2702629">00071</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1af879eaad910aedf7600094c3f2702629">UpdateChannels</link>()
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00072"/>00072 &#32;&#32;&#32;&#32;{
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00073"/>00073 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">foreach</emphasis>&#32;(var&#32;account&#32;<emphasis role="keywordflow">in</emphasis>&#32;<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1adeeb9334bff87bbe93b7a9a946d5874f">Accounts</link>)
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00074"/>00074 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">foreach</emphasis>&#32;(var&#32;<emphasis role="keywordtype">id</emphasis>&#32;<emphasis role="keywordflow">in</emphasis>&#32;<link linkend="_class_better_you_tube_feed_1_1_you_tube_data_a_p_i">YouTubeDataAPI</link>.<link linkend="_class_better_you_tube_feed_1_1_you_tube_data_a_p_i_1ac1ebaa0b9edbdadfa87004f1367d2f6d">GetSubsctiptionsID</link>(account))
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00075"/>00075 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!this.<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1a0ca95b52157ac2bae83ee88dd1e2257c">Channels</link>.Any(s&#32;=&gt;&#32;s.ChannelId&#32;==&#32;<emphasis role="keywordtype">id</emphasis>))
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00076"/>00076 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;this.<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1a0ca95b52157ac2bae83ee88dd1e2257c">Channels</link>.Add(<link linkend="_class_better_you_tube_feed_1_1_you_tube_data_a_p_i">YouTubeDataAPI</link>.<link linkend="_class_better_you_tube_feed_1_1_you_tube_data_a_p_i_1abc5134491f99e9f2df0c58fb0f05c0f0">GetChannelInfo</link>(account,&#32;<emphasis role="keywordtype">id</emphasis>));
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00077"/>00077 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;this.SaveChanges();
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00078"/>00078 &#32;&#32;&#32;&#32;}
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00079"/>00079 
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00083"/><link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1a0868601dcedf61b4640ca0cc2c040185">00083</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1a0868601dcedf61b4640ca0cc2c040185">UpdateVideos</link>()
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00084"/>00084 &#32;&#32;&#32;&#32;{
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00085"/>00085 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!this.<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1adeeb9334bff87bbe93b7a9a946d5874f">Accounts</link>.IsNullOrEmpty())
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00086"/>00086 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00087"/>00087 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_class_better_you_tube_feed_1_1_models_1_1_account">Account</link>&#32;tmp&#32;=&#32;this.<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1adeeb9334bff87bbe93b7a9a946d5874f">Accounts</link>.First();
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00088"/>00088 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">foreach</emphasis>&#32;(var&#32;channel&#32;<emphasis role="keywordflow">in</emphasis>&#32;this.<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1a0ca95b52157ac2bae83ee88dd1e2257c">Channels</link>)
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00089"/>00089 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">foreach</emphasis>&#32;(var&#32;video&#32;<emphasis role="keywordflow">in</emphasis>&#32;<link linkend="_class_better_you_tube_feed_1_1_you_tube_data_a_p_i">YouTubeDataAPI</link>.<link linkend="_class_better_you_tube_feed_1_1_you_tube_data_a_p_i_1a5e1e0c000e639de426c49456530c7a41">GetVideos</link>(tmp,&#32;channel.ChannelId))
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00090"/>00090 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!this.<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1a80ddc96bef6a30663e08224d6c36d726">Videos</link>.Any(v&#32;=&gt;&#32;v.VideoId&#32;==&#32;video.VideoId))
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00091"/>00091 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;this.<link linkend="_class_better_you_tube_feed_1_1_data_1_1_b_y_t_f_context_1a80ddc96bef6a30663e08224d6c36d726">Videos</link>.Add(video);
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00092"/>00092 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;this.SaveChanges();
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00093"/>00093 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00094"/>00094 &#32;&#32;&#32;&#32;}
<anchor xml:id="__b_y_t_f_context_8cs_source_1l00095"/>00095 }&#32;&#32;&#32;
</programlisting></section>
